<html lang="kr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>집광형 태양열 발전 시스템 모니터링</title>
  <!-- Default Js -->
  <%- include("../master/head.ejs") %>
  <script type="text/javascript" src="/js/svg/svg.js"></script>
  <script type="text/javascript" src="/js/svg/svg.filter.js"></script>
  <script type="text/javascript" src="/js/svg/jquery.panzoom.js"></script>
  <script type="text/javascript" src="/js/svg/drawSvg.js"></script>
</head>

<body class="hidden" style="overflow-y: hidden">
  <div id="wrap" class="wrap">
    <!-- <div class="center"> -->
    <!--메인-->
    <div class="text-center">
      <div class="row_st_line min_h_780">
        <div id="zoom" style="display: flex; justify-content: center;">
          <button id="zoom-in" class="btn btn-default btn-sm" style="margin-right: 5px"><span class="glyphicon glyphicon-zoom-in"></span>
            Zoom-in</button>
          <button id="zoom-out" class="btn btn-default btn-sm" style="margin-right: 5px"><span class="glyphicon glyphicon-zoom-out"></span>
            Zoom-out</button>
          <button id="reset" class="btn btn-default btn-sm" style="margin-right: 5px"><span class="glyphicon glyphicon-refresh"></span>
            Reset</button>
          <button id="close" class="btn btn-default btn-sm" style="margin-right: 5px"><span class="glyphicon glyphicon-folder-close"></span>
            Close</button>
        </div>
        <!-- canvas -->
        <div>
          <div id="canvas" style=" display: flex; justify-content: center; margin: 5px;"></div>
          <!-- <div id="canvas" style="background-image: url('/image/sunda/bg.jpg'); background-size: cover; background-repeat: no-repeat; display: flex; justify-content: center; margin: 5px"></div> -->
        </div>
      </div>
    </div>
    <div id="data"></div>
    <!-- </div> -->
  </div>

  <!-- Map 설정 및 Canvas 그림 -->
  <script>
    var map = <%- JSON.stringify(map) %>

    drawSvgCanvas('canvas', '/image/sunda/bg.jpg', '집광형 태양열 발전 시스템 모니터링');

    // size 재설정
    var svgMap = SVG.get('canvasId')
    var canvas = document.getElementById('canvas')
    canvas.style.width = svgMap.node.width.baseVal.value + 'px'
    canvas.style.height = svgMap.node.height.baseVal.value + 'px'

    // panzoom 기능
    var $panzoom = $('#canvas').panzoom({
      // $zoomIn: $('#zoom-in'),
      // $zoomOut: $('#zoom-out'),
      $reset: $('#reset'),
      cursor: "context-menu",
      startTransform: 'matrix(0.6, 0, 0, 0.6, -100, -600)',
    })

    // zoom 기능 기준점 재정의
    $('#zoom-in').click(function (e) {
      e.clientX = 300
      e.clientY = 200
      $panzoom.panzoom('zoom', {
        // focal: e
      })
    })

    $('#zoom-out').click(function (e) {
      e.clientX = 300
      e.clientY = 200
      $panzoom.panzoom('zoom', 'zoomOut', {
        focal: e
      })
    })

    $('#close').click(function (e) {
      $(this).parent().addClass('hidden')
    })

    // dataInstallEvent();
    // drawExistCanvasValue(id, value)
  </script>

  <script src="/socket.io/socket.io.js" defer></script>
  <script defer>
    $(function () {
      var socket = io();

      // 접속한 사용자의 정보를 보내줌.
      socket.emit("connection");

      // 노드 관련 갱신 반영
      socket.on("updateNodeInfo", function (nodeList) {
        console.log(nodeList)
        _.forEach(nodeList, nodeInfo => {
          showDataValue(nodeInfo.node_id, nodeInfo.data)
        })

        // document.getElementById("data").innerText = data;
      });
    });

    window.onload = () => {
      $('body').removeClass('hidden')
    }
  </script>


</body>

</html>