<!DOCTYPE html>
<html>

<head>
  <!-- Default Js -->
  <%- include("../master/head.ejs") %>
  <script src="/js/contents/master/mainUtil.js"></script>
  <script src="/js/contents/inverter/setInverter.js"></script>
  <%- include("./mediaQuery.ejs") %>
</head>

<body>
  <div id="wrap" class="wrap hidden" style="background-image: url('/image/bg_1025.jpg'); background-color:#e9e9e9;">
    <div class="center">
      <!-- Header -->
      <%- include("../master/header.ejs") %>
      <!--메인-->
      <div class="containera">
        <div class="text-center containerb">
          <div class="title">
            <p id="inverterMeasureTime"> 실시간 인버터 모니터링 측정시간 : 2018-10-17 10:27:00</p>
          </div>
          <div class="table-responsive" style="overflow-x:visible;">
            <table class="table table-bordered" style="width:100%;background:#fff;">
              <thead>
                <tr>
                  <th scope="col" rowspan="2" style="width:10%"></th>
                  <th scope="col" colspan="4" style="text-align:center; width:30%">태양광</th>
                  <th scope="col" colspan="3" style="text-align:center; width:20%">인버터</th>
                  <th scope="col" colspan="5" style="text-align:center; width:40%">발전현황</th>
                </tr>
                <tr>
                  <td style="width:8%;">경사일사량W/㎥</td>
                  <td style="width:7%;">DC전류(A)</td>
                  <td style="width:7%;">DC전압(V)</td>
                  <td style="width:7%;">DC전력(kW)</td>
                  <td style="width:8%;">AC전류(A)</td>
                  <td style="width:8%;">AC전압(V)</td>
                  <td style="width:8%;">주파수(Hz)</td>
                  <td style="width:8%;">현재전력(kW)</td>
                  <td style="width:6%;">효율</td>
                  <td style="width:8%;">금일발전량(kWh)</td>
                  <td style="width:8%;">누적발전량(kWh)</td>
                  <td style="width:5%;">동작여부</td>
                </tr>
              </thead>
              <tbody id="inverterStatus">
              </tbody>
            </table>
          </div>
        </div>
        <div class="text-center" style="background-color:#fff; height:auto;">
          <div class="row row_width  top_box">
            <div class="title" style="margin-top:20px;">
              <p>금일 시간 별 전력</p>
            </div>
            <div id="chart_div" style="width:100%; height:300px; background-color:#fff;"></div>
          </div>
        </div>
      </div>
      <!--하단1-->
      <div class="container-fluid bg-3 text-center">
      </div><br>
      <%- include("../master/footer.ejs") %>
    </div>
  </div>
  <script>
    // 인버터 측정 시간 입력
    document.getElementById('inverterMeasureTime').innerHTML = <%- JSON.stringify(measureInfo.measureTime) %>;

    // 인버터 현재 상태 데이터 테이블 생성
    $('#inverterStatus').html(<%- JSON.stringify(dom.inverterStatusListDom) %>)


    // 차트를 그리기 위한 데이터
    let inverterPowerChart = <%- JSON.stringify(inverterPowerChart) %>;

    console.log(_.head(inverterPowerChart.range))
    if (inverterPowerChart.series.length) {
      var yMax = 1500;

      $('#chart_div').highcharts({
        chart: {
          type: "spline",
          zoomType: 'xy',
        },
        title: {
          text: ''
        },
        xAxis: {
          type: 'datetime',
          // opposite: true,
          title: {
            text: '시간(시)'
          },
          labels: {
            overflow: 'justify'
          },
          // tickInterval: 6,
          categories: inverterPowerChart.range
        },
        yAxis: {
          // max: yMax,
          title: {
            text: '전력(kW)'
          },
        },
        plotOptions: {
          series: {
            pointStart: 0
          },
          spline: {
            lineWidth: 2,
            states: {
              hover: {
                lineWidth: 3
              }
            },
            marker: {
              enabled: false
            },
            // pointInterval: 1000 * 60 * 10, // 10 min
            // // pointStart: Date.UTC(2018, 1, 13, 0, 0, 0)
            // pointStart: _.head(inverterPowerChart.range)
          }
        },
        legend: { //범례
          // layout: 'vertical',
          align: 'center',
          verticalAlign: 'bottom',
          borderWidth: 0,
        },
        series: inverterPowerChart.series,
        credits: {
          enabled: false
        },
      });
    } else {
      $("#chart_div").html("발전 내역이 존재하지 않습니다.").css({
        "line-height": "300px",
        "font-size": "25px"
      });
    }
  </script>
</body>

</html>